<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fantinal Publishing</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        .paid-badge { background: #f59e0b; color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px; }
        .free-badge { background: #10b981; color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px; }
    </style>
</head>
<body class="bg-gray-100 text-gray-900">
    <nav class="bg-white shadow-md p-4 sticky top-0 z-50 flex justify-between items-center">
        <h1 class="text-xl font-bold text-blue-600">Fantinal</h1>
        <div id="userInfo" class="flex items-center gap-4">
            <span id="userCoins" class="font-bold text-orange-500">ðŸ’° 0 C</span>
            <button onclick="logout()" class="text-sm text-red-500">Logout</button>
        </div>
    </nav>

    <div id="authContainer" class="max-w-md mx-auto mt-10 p-6 bg-white rounded shadow-lg hidden">
        <h2 class="text-2xl font-bold mb-4">Login / Register</h2>
        <input type="email" id="email" placeholder="Email" class="w-full p-2 mb-2 border rounded">
        <input type="password" id="password" placeholder="Password" class="w-full p-2 mb-4 border rounded">
        <button onclick="login()" class="w-full bg-blue-500 text-white p-2 rounded mb-2">Login</button>
        <button onclick="register()" class="w-full bg-green-500 text-white p-2 rounded">Register</button>
    </div>

    <main id="mainContent" class="max-w-4xl mx-auto p-4 hidden">
        <div id="adminPanel" class="hidden bg-white p-6 rounded shadow mb-6">
            <h2 class="text-xl font-bold mb-4">Add New Chapter</h2>
            <input type="text" id="novelTitle" placeholder="Novel Name" class="w-full p-2 mb-2 border rounded">
            <input type="text" id="chapterTitle" placeholder="Chapter (e.g. Chapter 1)" class="w-full p-2 mb-2 border rounded">
            <textarea id="content" placeholder="Story Content..." class="w-full p-2 mb-2 border rounded h-32"></textarea>
            <input type="number" id="coinPrice" placeholder="Coins required (0 for Free)" class="w-full p-2 mb-4 border rounded">
            <button onclick="uploadChapter()" class="bg-blue-600 text-white px-6 py-2 rounded">Publish</button>
        </div>

        <div id="chapterList" class="grid gap-4"></div>
    </main>

    <script>
        // --- Firebase Configuration (á€žá€„á€·á€ºá€›á€²á€· Config á€€á€­á€¯ á€’á€®á€™á€¾á€¬ á€•á€¼á€”á€ºá€‘á€Šá€·á€ºá€•á€«) ---
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Check Auth State
        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById('authContainer').classList.add('hidden');
                document.getElementById('mainContent').classList.remove('hidden');
                if (user.email === 'xztka49@gmail.com') document.getElementById('adminPanel').classList.remove('hidden');
                fetchUserData(user.uid);
                loadChapters();
            } else {
                document.getElementById('authContainer').classList.remove('hidden');
                document.getElementById('mainContent').classList.add('hidden');
            }
        });

        async function fetchUserData(uid) {
            const doc = await db.collection('users').doc(uid).get();
            if (doc.exists) {
                document.getElementById('userCoins').innerText = `ðŸ’° ${doc.data().coins || 0} C`;
            } else {
                await db.collection('users').doc(uid).set({ coins: 0 });
            }
        }

        async function uploadChapter() {
            const title = document.getElementById('novelTitle').value;
            const chapter = document.getElementById('chapterTitle').value;
            const content = document.getElementById('content').value;
            const price = parseInt(document.getElementById('coinPrice').value) || 0;

            await db.collection('chapters').add({
                title, chapter, content, price, createdAt: new Date()
            });
            alert('Uploaded!');
            loadChapters();
        }

        async function loadChapters() {
            const snapshot = await db.collection('chapters').orderBy('createdAt', 'desc').get();
            const list = document.getElementById('chapterList');
            list.innerHTML = '';
            snapshot.forEach(doc => {
                const data = doc.data();
                const isPaid = data.price > 0;
                list.innerHTML += `
                    <div class="bg-white p-4 rounded shadow flex justify-between items-center">
                        <div>
                            <h3 class="font-bold">${data.title} - ${data.chapter}</h3>
                            <span class="${isPaid ? 'paid-badge' : 'free-badge'}">${isPaid ? data.price + ' Coins' : 'Free'}</span>
                        </div>
                        <button onclick="readChapter('${doc.id}', ${data.price})" class="bg-blue-500 text-white px-4 py-1 rounded">Read</button>
                    </div>
                `;
            });
        }

        async function readChapter(id, price) {
            const uid = auth.currentUser.uid;
            const userDoc = await db.collection('users').doc(uid).get();
            const userCoins = userDoc.data().coins || 0;

            if (price > 0) {
                if (userCoins < price) return alert('Coin á€™á€œá€±á€¬á€€á€ºá€•á€«á‹');
                if (confirm(`${price} Coins á€žá€¯á€¶á€¸á€•á€¼á€®á€¸ á€–á€á€ºá€™á€¾á€¬á€œá€¬á€¸?`)) {
                    await db.collection('users').doc(uid).update({ coins: userCoins - price });
                    fetchUserData(uid);
                } else { return; }
            }

            const chap = await db.collection('chapters').doc(id).get();
            alert("Content: \n\n" + chap.data().content);
        }

        function login() { /* Standard Firebase Login */ }
        function register() { /* Standard Firebase Register */ }
        function logout() { auth.signOut(); }
    </script>
</body>
</html>
