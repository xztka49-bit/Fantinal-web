<!DOCTYPE html>
<html>
<head>
    <title>Fantinal Admin - V2</title>
    <style>
        body { background: #0B1120; color: white; font-family: sans-serif; padding: 20px; }
        .box { background: #111827; padding: 20px; border: 1px solid #D4AF37; border-radius: 10px; max-width: 500px; margin: 20px auto; }
        input, textarea, select { width: 100%; padding: 12px; margin: 10px 0; background: #1F2937; border: 1px solid #374151; color: white; border-radius: 5px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: #D4AF37; border: none; font-weight: bold; cursor: pointer; border-radius: 5px; }
    </style>
</head>
<body>

<div class="box">
    <h2>1. Upload Novel</h2>
    <input type="text" id="n-title" placeholder="Title">
    <input type="text" id="n-author" placeholder="Author">
    <textarea id="n-desc" placeholder="Description"></textarea>
    <input type="text" id="n-cover" placeholder="Cover URL">
    <button onclick="saveNovel()">SAVE NOVEL</button>
</div>

<div class="box">
    <h2>2. Add Chapter</h2>
    <select id="novel-select"><option>Loading Novels...</option></select>
    <input type="number" id="c-num" placeholder="Chapter Number">
    <input type="text" id="c-title" placeholder="Chapter Title">
    <textarea id="c-content" placeholder="Content" rows="10"></textarea>
    <input type="number" id="c-cost" placeholder="Cost (Coins)">
    <button onclick="saveChapter()">PUBLISH CHAPTER</button>
</div>

<div class="box">
    <h2>3. Generate Gift Code</h2>
    <input type="number" id="g-amt" placeholder="Coin Amount (e.g. 5000)">
    <button style="background: #10B981;" onclick="generateGiftCode()">GENERATE CODE</button>
    <p id="code-output" style="text-align:center; color:#D4AF37; font-weight:bold; font-size:1.2rem; margin-top:10px;"></p>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBxh92A7E6Egtk4kYB23Wmlelq13YYh1J0",
    authDomain: "fantinal-publishing-5b960.firebaseapp.com",
    projectId: "fantinal-publishing-5b960",
    storageBucket: "fantinal-publishing-5b960.firebasestorage.app",
    messagingSenderId: "961612304854",
    appId: "1:961612304854:web:6bf7b03072ed83b58b9477"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Novel စာရင်းကို Dropdown ထဲ ထည့်ခြင်း
  async function fetchNovels() {
    const snap = await getDocs(collection(db, "novels"));
    const select = document.getElementById('novel-select');
    select.innerHTML = "";
    snap.forEach(doc => {
      select.innerHTML += `<option value="${doc.id}">${doc.data().title}</option>`;
    });
  }
  fetchNovels();

  window.saveNovel = async () => { /* အရင်က code အတိုင်း */ };

  window.saveChapter = async () => {
    const nid = document.getElementById('novel-select').value;
    try {
      await addDoc(collection(db, "novels", nid, "chapters"), {
        num: Number(document.getElementById('c-num').value),
        title: document.getElementById('c-title').value,
        content: document.getElementById('c-content').value,
        cost: Number(document.getElementById('c-cost').value),
        createdAt: serverTimestamp()
      });
      alert("Chapter Published!");
    } catch (e) { alert(e.message); }
  };

  window.generateGiftCode = async () => {
    const amt = document.getElementById('g-amt').value;
    const code = "FAN-" + Math.random().toString(36).substring(2, 8).toUpperCase();
    try {
      await addDoc(collection(db, "gift_codes"), {
        code: code,
        amount: Number(amt),
        isUsed: false,
        createdAt: serverTimestamp()
      });
      document.getElementById('code-output').innerText = code;
    } catch (e) { alert(e.message); }
  };
</script>
</body>
</html>
