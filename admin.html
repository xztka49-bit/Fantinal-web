<!DOCTYPE html>
<html>
<head>
    <title>Fantinal Admin - Content Manager</title>
    <style>
        :root { --gold: #D4AF37; --bg: #0B1120; --card: #111827; }
        body { background: var(--bg); color: white; font-family: sans-serif; padding: 20px; }
        .container { max-width: 800px; margin: auto; }
        .box { background: var(--card); padding: 20px; border: 1px solid var(--gold); border-radius: 12px; margin-bottom: 25px; }
        h2 { color: var(--gold); border-bottom: 1px solid #374151; padding-bottom: 10px; margin-top: 0; }
        input, textarea, select { width: 100%; padding: 12px; margin: 8px 0; background: #1F2937; border: 1px solid #374151; color: white; border-radius: 6px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: var(--gold); border: none; font-weight: bold; border-radius: 6px; cursor: pointer; margin-top: 5px; }
        .list-item { background: #1F2937; padding: 12px; margin: 8px 0; display: flex; justify-content: space-between; align-items: center; border-radius: 6px; border-left: 4px solid var(--gold); }
        .edit-btn { background: #3B82F6; width: auto; padding: 6px 12px; font-size: 0.8rem; border-radius: 4px; border: none; color: white; cursor: pointer; }
    </style>
</head>
<body>
<div class="container">
    <h1 style="color: var(--gold); text-align: center;">FANTINAL ADMIN</h1>

    <div class="box">
        <h2>üìñ Add New Novel</h2>
        <input type="text" id="n-title" placeholder="Novel Title">
        <input type="text" id="n-author" placeholder="Author Name">
        <textarea id="n-desc" placeholder="Novel Description" rows="3"></textarea>
        <input type="text" id="n-cover" placeholder="Cover Image URL (e.g. https://...)">
        <button onclick="saveNovel()">UPLOAD NOVEL</button>
    </div>

    <div class="box">
        <h2>‚öôÔ∏è Manage Novels</h2>
        <div id="novel-list-admin">Loading...</div>
    </div>

    <div class="box">
        <h2>üìë Add New Chapter</h2>
        <select id="novel-select-add-chapter"></select>
        <input type="number" id="c-num" placeholder="Chapter No.">
        <input type="text" id="c-title" placeholder="Chapter Title">
        <textarea id="c-content" placeholder="Story Content..." rows="8"></textarea>
        <input type="number" id="c-cost" placeholder="Coins Cost (0 for Free)">
        <button onclick="saveChapter()">PUBLISH CHAPTER</button>
    </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, serverTimestamp, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBxh92A7E6Egtk4kYB23Wmlelq13YYh1J0",
    authDomain: "fantinal-publishing-5b960.firebaseapp.com",
    projectId: "fantinal-publishing-5b960",
    storageBucket: "fantinal-publishing-5b960.firebasestorage.app",
    messagingSenderId: "961612304854",
    appId: "1:961612304854:web:6bf7b03072ed83b58b9477"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  async function loadData() {
    const snap = await getDocs(collection(db, "novels"));
    const listDiv = document.getElementById('novel-list-admin');
    const select = document.getElementById('novel-select-add-chapter');
    listDiv.innerHTML = "";
    select.innerHTML = '<option value="">-- Select Novel --</option>';

    snap.forEach(d => {
      const n = d.data();
      listDiv.innerHTML += `<div class="list-item"><span>${n.title}</span><button class="edit-btn" style="background:#EF4444" onclick="deleteNovel('${d.id}')">Delete</button></div>`;
      select.innerHTML += `<option value="${d.id}">${n.title}</option>`;
    });
  }
  loadData();

  window.saveNovel = async () => {
    const title = document.getElementById('n-title').value;
    if(!title) return alert("Title is required!");
    await addDoc(collection(db, "novels"), {
      title: title,
      author: document.getElementById('n-author').value,
      desc: document.getElementById('n-desc').value,
      cover: document.getElementById('n-cover').value,
      createdAt: serverTimestamp()
    });
    alert("Novel Added!");
    loadData();
  };

  window.saveChapter = async () => {
    const nid = document.getElementById('novel-select-add-chapter').value;
    if(!nid) return alert("Select a novel!");
    await addDoc(collection(db, "novels", nid, "chapters"), {
      num: Number(document.getElementById('c-num').value),
      title: document.getElementById('c-title').value,
      content: document.getElementById('c-content').value,
      cost: Number(document.getElementById('c-cost').value),
      createdAt: serverTimestamp()
    });
    alert("Chapter Published!");
  };

  window.deleteNovel = async (id) => {
    if(confirm("Delete this novel?")) {
      await deleteDoc(doc(db, "novels", id));
      loadData();
    }
  };
</script>
</body>
</html>
